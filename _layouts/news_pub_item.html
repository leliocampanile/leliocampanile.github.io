{%- comment -%} Template compatto per la Home con badge e link robusti {%- endcomment -%}

{%- assign e = entry -%}
{%- assign venue = e.journal | default: e.booktitle | default: e.series | default: e.publisher -%}

{%- comment -%} URL dettagli robusto, indipendente da .html vs /index.html {%- endcomment -%}
{%- capture detail_url -%}{% details_link e.key %}{%- endcapture -%}

{%- comment -%} Link primario (priorità: DOI → URL editore → details) {%- endcomment -%}
{%- assign primary_link = nil -%}
{%- if e.doi -%}
  {%- assign primary_link = 'https://doi.org/' | append: e.doi -%}
{%- elsif e.url -%}
  {%- assign primary_link = e.url -%}
{%- else -%}
  {%- assign primary_link = detail_url -%}
{%- endif -%}

{%- comment -%} Badge: prova dal type, poi fallback journal/booktitle {%- endcomment -%}
{%- assign raw_kind = e.type | default: '' | downcase | strip -%}
{%- assign pub_badge = nil -%}
{%- if raw_kind contains 'article' -%}{% assign pub_badge = 'Journal' %}
{%- elsif raw_kind contains 'conference' -%}{% assign pub_badge = 'Conference' %}
{%- elsif raw_kind contains 'book chapter' -%}{% assign pub_badge = 'Book Chapter' %}
{%- else %}{% assign pub_badge = 'Other' %}
{%- endif -%}
{%- if pub_badge == nil -%}
  {%- if e.journal %}{% assign pub_badge = 'Journal' %}
  {%- elsif e.booktitle %}{% assign pub_badge = 'Conference' %}
  {%- else %}{% assign pub_badge = 'Other' %}{% endif -%}
{%- endif -%}
{%- assign pub_class = pub_badge | downcase | replace: ' ', '-' -%}

<div class="news-pub">
  <div class="news-title">
    <strong><a href="{{ detail_url }}" {% if primary_link != detail_url %}target="_blank" rel="noopener"{% endif %}>{{ e.title }}</a></strong>
  </div>

  <div class="news-meta">
    <span class="pub-badge pub-badge-{{ pub_class }}">{{ pub_badge }}</span>
    {{ e.author }}
    {%- if venue %} — <em>{{ venue }}</em>{% endif -%}
    {%- if e.year %}, {{ e.year }}{% endif -%}
  </div>

  <div class="news-actions">
    <a class="btn btn-pub" href="{{ detail_url }}">Details</a>
    {%- if e.doi -%}
      <a class="btn btn-pub" href="https://doi.org/{{ e.doi }}" target="_blank" rel="noopener">DOI</a>
    {%- endif -%}
  </div>
</div>
